<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <base href="/">

    <title>
        
        Hypercube &mdash; aziis98.com
        
    </title>

    <meta name="description" content="Backport of a widget make for the old site">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" type="image/png" sizes="192x192" href="static/icon-192x192.png">

    <meta property="og:title" content="Hypercube">
    <meta property="og:description" content="Backport of a widget make for the old site">
    <meta property="og:image" content="static/icon-192x192.png" />

    

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <link rel="stylesheet" href="static/css/style.css">
    <link rel="stylesheet" href="static/css/lovelace.css">

    <link 
        rel="stylesheet" 
        href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
        integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
    <script 
        defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"
        integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" 
        crossorigin="anonymous"></script>
        
    <script type="module">
        Array.prototype.forEach.call(document.querySelectorAll('.math.inline'), $el => {
            console.log($el.innerText);
            katex.render($el.innerText, $el, { displayMode: false });
        });
        Array.prototype.forEach.call(document.querySelectorAll('.math.display'), $el => {
            katex.render($el.innerText, $el, { displayMode: true });
        });
    </script>

</head>

<body>
    <div class="nav-wrapper">
        <input type="checkbox" id="toggle-menu">
        <label for="toggle-menu">
            <span class="material-icons menu">menu</span>
            <span class="material-icons close">close</span>
        </label>
        <nav>
            <a class="logo" href="/" title="aziis98.com">
                <svg width="100%" height="100%" viewBox="0 0 1000 1000">
                    <g style="stroke-width:0.857654" transform="matrix(1.165971,0,0,1.165971,-82.985498,-82.985496)"
                       id="layer1">
                        <path d="m 370.35583,737.36325 52.42963,-138.22357 c 4.76633,-12.39246 10.48592,-16.20552 33.36431,-16.20552 h 198.27932 l 58.14923,161.10195 c 13.34572,40.03717 -25.73818,36.22411 -70.54168,39.08391 -5.7196,5.71959 -5.7196,25.73818 0,31.45778 35.27084,-0.95327 87.70047,-1.90654 124.87784,-1.90654 39.08391,0 73.40148,0.95327 108.67232,1.90654 5.7196,-5.7196 5.7196,-25.73819 0,-31.45778 -37.17737,-2.8598 -68.63515,-2.8598 -85.79394,-52.42963 L 594.37334,214.02022 c -5.7196,-9.53266 -7.62613,-16.20552 -14.29899,-27.64471 -50.5231,0.95326 -121.06478,0.95326 -129.64418,-0.95327 -5.71959,7.62613 -8.57939,8.5794 -19.06532,34.31758 L 219.7398,715.43813 c -25.73818,59.10249 -54.33616,64.82209 -95.3266,67.68189 -5.71959,5.71959 -5.71959,25.73818 0,31.45778 35.27084,-0.95327 47.6633,-1.90654 84.84068,-1.90654 39.0839,0 191.60646,0.95327 226.8773,1.90654 5.7196,-5.7196 5.7196,-25.73819 0,-31.45778 -36.22411,-1.90653 -81.02761,-5.7196 -65.77535,-45.75677 z M 473.30856,542.89699 c -21.92512,0 -28.59798,-1.90653 -24.78492,-12.39246 L 544.8035,288.37497 h 1.90654 l 92.4668,254.52202 z M 508.5794,205.44083 h 45.75676 L 323.64579,784.07328 h -49.56983 z"
                              style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:Arial;-inkscape-font-specification:Arial;fill:#000000;fill-opacity:1;stroke:none;stroke-width:4.28826"
                              id="path836" />
                    </g>
                </svg>
            </a>
            <div class="nav-group">
                <a id="nav-unipi" style="display: none;" class="nav-link" href="page/unipi.html">Università</a>
                <a class="nav-link" href="">Posts</a>
                <a class="nav-link" href="page/about.html">About</a>
            </div>
        </nav>
    </div>
    <main>

        <article>
    <header class="post-header">
        <h1 class="post-title">Hypercube</h1>
        <div class="post-date">
            Posted on the 
            <span>2017/10/10</span>
            by
            <a href="" rel="author">Antonio De Lucreziis</a>
        </div>
        <p class="post-tags">
            
            <a href="tags/math.html" class="tag">#math</a>
            
            <a href="tags/webdev.html" class="tag">#webdev</a>
            
        </p>
    </header>

    <p>Here is an hypercube, ported from the old website hosted on <a href="https://poisson.phc.dm.unipi.it/~delucreziis">https://poisson.phc.dm.unipi.it<wbr>/~delucreziis</a>.</p>
<canvas width="400" height="400" id="canvas">
</canvas>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.17.0/math.min.js"></script>
<script src="/static/js/hypercube.js"></script>
<style>
#canvas {
    display: block;
    margin: 0 auto;
    border: 1px solid #aaa;
}
</style>
<h2 id="explaination">Explaination</h2>
<p><strong>Warning.</strong> Be aware that this is a bad explanation of some bad code so don’t expect much for now. I’ll try to enhance this code someday.</p>
<p>First lets define the canvas, the hypercube vertices and all edges (in index notation). So we have <span class="math inline">\texttt{cubePoints} := \{ -1, 1\}^4</span>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">const</span> $canvas <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;#canvas&#39;</span>)<span class="op">;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="kw">const</span> cubePoints <span class="op">=</span> [</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>    [<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">-1</span><span class="op">,</span> <span class="dv">-1</span><span class="op">,</span> <span class="dv">-1</span>]<span class="op">,</span> [<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">-1</span><span class="op">,</span> <span class="dv">-1</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> [<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">-1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">-1</span>]<span class="op">,</span> [<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">-1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>    [<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">-1</span><span class="op">,</span> <span class="dv">-1</span>]<span class="op">,</span> [<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">-1</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> [<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">-1</span>]<span class="op">,</span> [<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>    [<span class="dv">1</span><span class="op">,</span> <span class="dv">-1</span><span class="op">,</span> <span class="dv">-1</span><span class="op">,</span> <span class="dv">-1</span>]<span class="op">,</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">-1</span><span class="op">,</span> <span class="dv">-1</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">-1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">-1</span>]<span class="op">,</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">-1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>    [<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">-1</span><span class="op">,</span> <span class="dv">-1</span>]<span class="op">,</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">-1</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">-1</span>]<span class="op">,</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>]</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>]<span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a><span class="kw">const</span> lines <span class="op">=</span> [</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">9</span><span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">3</span>]<span class="op">,</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">15</span><span class="op">,</span> <span class="dv">13</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">14</span><span class="op">,</span> <span class="dv">6</span>]<span class="op">,</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>    [<span class="dv">8</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">13</span><span class="op">,</span> <span class="dv">9</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">,</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>    [<span class="dv">10</span><span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">15</span><span class="op">,</span> <span class="dv">14</span><span class="op">,</span> <span class="dv">10</span>]<span class="op">,</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>    [<span class="dv">6</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">3</span>]</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a>]<span class="op">;</span></span></code></pre></div>
<p>All the edges are drawn in batches, there isn’t much math behind those sequences I just added indices until all correct edges where on the screen. An interesting problem might actually see if there is a list of vertices that produces a single non overlapping sequences of all the edges of the hypercube.</p>
<p>[TODO: Better explain this part] The interesting bit is the rotation and projection code. The rotation in 4d in on the <span class="math inline">O\hat x \hat w</span> plane and after the projection there are two more rotations for simplicity. The projection first takes a 4d vector and projects it first in 3d by “further things more on the outside” and then projects those in 2d. (It looks like that I used the library <a href="https://mathjs.org/" class="uri">https://mathjs.org/</a> for doing all the matrix multiplications)</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">rotationMatrix4</span>(theta) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>    <span class="cf">return</span> [</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>        [math<span class="op">.</span><span class="fu">cos</span>(theta)<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="op">-</span>math<span class="op">.</span><span class="fu">sin</span>(theta)]<span class="op">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>        [              <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span>                <span class="dv">0</span>]<span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>        [              <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span>                <span class="dv">0</span>]<span class="op">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>        [math<span class="op">.</span><span class="fu">sin</span>(theta)<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span>  math<span class="op">.</span><span class="fu">cos</span>(theta)]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>    ]<span class="op">;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>}</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">rotationMatrix3x</span>(theta) {</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>    <span class="cf">return</span> [</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a>        [<span class="dv">1</span><span class="op">,</span>               <span class="dv">0</span><span class="op">,</span>               <span class="dv">0</span> ]<span class="op">,</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a>        [<span class="dv">0</span><span class="op">,</span> math<span class="op">.</span><span class="fu">cos</span>(theta)<span class="op">,</span> <span class="op">-</span>math<span class="op">.</span><span class="fu">sin</span>(theta)]<span class="op">,</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a>        [<span class="dv">0</span><span class="op">,</span> math<span class="op">.</span><span class="fu">sin</span>(theta)<span class="op">,</span>  math<span class="op">.</span><span class="fu">cos</span>(theta)]</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true"></a>    ]<span class="op">;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true"></a>}</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">rotationMatrix3y</span>(theta) {</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true"></a>    <span class="cf">return</span> [</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true"></a>        [ math<span class="op">.</span><span class="fu">cos</span>(theta)<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> math<span class="op">.</span><span class="fu">sin</span>(theta)]<span class="op">,</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true"></a>        [               <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span>               <span class="dv">0</span>]<span class="op">,</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true"></a>        [<span class="op">-</span>math<span class="op">.</span><span class="fu">sin</span>(theta)<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> math<span class="op">.</span><span class="fu">cos</span>(theta)]</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true"></a>    ]<span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true"></a>}</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">project3d</span>(vet4) {</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true"></a>    <span class="co">// Drops 4th component</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true"></a>    <span class="cf">return</span> vet4<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">.</span><span class="fu">map</span>(it <span class="kw">=&gt;</span> it <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(vet4[<span class="dv">3</span>] <span class="op">+</span> <span class="fl">2.0</span>))<span class="op">;</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true"></a>}</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">project2d</span>(vet3) {</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true"></a>    <span class="co">// Drops 3th component</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true"></a>    <span class="cf">return</span> vet3<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span>)<span class="op">.</span><span class="fu">map</span>(it <span class="kw">=&gt;</span> <span class="fl">600.0</span> <span class="op">*</span> it <span class="op">/</span> (vet3[<span class="dv">2</span>] <span class="op">-</span> <span class="fl">20.0</span>))<span class="op">;</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true"></a>}</span></code></pre></div>
<p>At last there is the actual rendering code that computes all rotations and projection and draws the cube wireframe.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">let</span> ticks <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="kw">let</span> angleY <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="kw">let</span> angleW <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a><span class="kw">let</span> inputState <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">render</span>() {</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a>    ticks<span class="op">++;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a>    <span class="kw">const</span> rotW <span class="op">=</span> inputState <span class="op">==</span> <span class="st">&#39;none&#39;</span> <span class="op">?</span> ticks <span class="op">/</span> <span class="fl">200.0</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">2</span> <span class="op">:</span> angleW<span class="op">;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a>    <span class="kw">const</span> rotY <span class="op">=</span> inputState <span class="op">==</span> <span class="st">&#39;none&#39;</span> <span class="op">?</span> ticks <span class="op">/</span> <span class="fl">400.0</span> <span class="op">:</span> angleY<span class="op">;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a>    <span class="kw">const</span> ctx <span class="op">=</span> $canvas<span class="op">.</span><span class="fu">getContext</span>(<span class="st">&#39;2d&#39;</span>)<span class="op">;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a>    ctx<span class="op">.</span><span class="fu">clearRect</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> $canvas<span class="op">.</span><span class="at">width</span><span class="op">,</span> $canvas<span class="op">.</span><span class="at">height</span>)<span class="op">;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true"></a>    ctx<span class="op">.</span><span class="fu">translate</span>($canvas<span class="op">.</span><span class="at">width</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> $canvas<span class="op">.</span><span class="at">height</span> <span class="op">/</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true"></a>    ctx<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">&#39;#000&#39;</span><span class="op">;</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true"></a>    <span class="kw">const</span> projPoints <span class="op">=</span> cubePoints<span class="op">.</span><span class="fu">map</span>((pt<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true"></a>        <span class="kw">const</span> pt3 <span class="op">=</span> <span class="fu">project3d</span>(math<span class="op">.</span><span class="fu">multiply</span>(<span class="fu">rotationMatrix4</span>(rotW)<span class="op">,</span> pt))<span class="op">;</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true"></a>        <span class="kw">const</span> proj <span class="op">=</span> <span class="fu">project2d</span>(</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true"></a>            math<span class="op">.</span><span class="fu">multiply</span>(</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true"></a>                <span class="fu">rotationMatrix3x</span>(<span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">6</span>)<span class="op">,</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true"></a>                math<span class="op">.</span><span class="fu">multiply</span>(</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true"></a>                    <span class="fu">rotationMatrix3y</span>(<span class="op">-</span>rotY)<span class="op">,</span> </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true"></a>                    math<span class="op">.</span><span class="fu">add</span>([<span class="dv">0</span><span class="op">,</span> <span class="fl">0.3</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span> pt3)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true"></a>                )</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true"></a>            )</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true"></a>        )<span class="op">;</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true"></a>        <span class="cf">return</span> proj<span class="op">;</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true"></a>    })<span class="op">;</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true"></a>    ctx<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">&#39;#333&#39;</span><span class="op">;</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true"></a></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true"></a>    lines<span class="op">.</span><span class="fu">forEach</span>(line <span class="kw">=&gt;</span> {</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true"></a></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true"></a>        ctx<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true"></a>        ctx<span class="op">.</span><span class="fu">moveTo</span>(projPoints[line[<span class="dv">0</span>]][<span class="dv">0</span>]<span class="op">,</span> projPoints[line[<span class="dv">1</span>]])<span class="op">;</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true"></a></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true"></a>        <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> line<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true"></a>            ctx<span class="op">.</span><span class="fu">lineTo</span>(projPoints[line[i]][<span class="dv">0</span>]<span class="op">,</span> projPoints[line[i]][<span class="dv">1</span>])<span class="op">;</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true"></a>        }</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true"></a></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true"></a>        ctx<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true"></a>    })<span class="op">;</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true"></a></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true"></a>    ctx<span class="op">.</span><span class="fu">translate</span>(<span class="op">-</span>$canvas<span class="op">.</span><span class="at">width</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> <span class="op">-</span>$canvas<span class="op">.</span><span class="at">height</span> <span class="op">/</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true"></a></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true"></a>    <span class="fu">requestAnimationFrame</span>(render)<span class="op">;</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true"></a></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true"></a>}</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true"></a></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true"></a><span class="fu">render</span>()<span class="op">;</span></span></code></pre></div>
<p>and then there are some listeners for device orientation on mobile and mouse input for the desktop.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="bu">window</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;deviceorientation&#39;</span><span class="op">,</span> e <span class="kw">=&gt;</span> {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>    <span class="cf">if</span> (e<span class="op">.</span><span class="at">alpha</span> <span class="op">!=</span> <span class="kw">null</span>) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>        angleY <span class="op">=</span> e<span class="op">.</span><span class="at">gamma</span> <span class="op">/</span> <span class="dv">90</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>        angleW <span class="op">=</span> e<span class="op">.</span><span class="at">beta</span> <span class="op">/</span> <span class="dv">180</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>        inputState <span class="op">=</span> <span class="st">&#39;gyro&#39;</span><span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>    }</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>})<span class="op">;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>$canvas<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;mouseenter&#39;</span><span class="op">,</span> e <span class="kw">=&gt;</span> {</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>    <span class="cf">if</span> (inputState <span class="op">!=</span> <span class="st">&#39;gyro&#39;</span>) inputState <span class="op">=</span> <span class="st">&#39;mouse&#39;</span><span class="op">;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>})<span class="op">;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a>$canvas<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;mouseleave&#39;</span><span class="op">,</span> e <span class="kw">=&gt;</span> {</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true"></a>    <span class="cf">if</span> (inputState <span class="op">!=</span> <span class="st">&#39;gyro&#39;</span>) inputState <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true"></a>})<span class="op">;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true"></a>$canvas<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;mousemove&#39;</span><span class="op">,</span> e <span class="kw">=&gt;</span> {</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true"></a>    angleY <span class="op">=</span> (e<span class="op">.</span><span class="at">offsetX</span> <span class="op">/</span> $canvas<span class="op">.</span><span class="at">width</span> <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> <span class="fl">5.0</span><span class="op">;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true"></a>    angleW <span class="op">=</span> (e<span class="op">.</span><span class="at">offsetY</span> <span class="op">/</span> $canvas<span class="op">.</span><span class="at">height</span> <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true"></a>})<span class="op">;</span></span></code></pre></div>


</article>

    </main>
    <footer>
        &copy; Antonio De Lucreziis 2020

        
    </footer>

    <script src="static/js/ux.js"></script>
</body>

</html>